define(["jquery","jsTree","xwiki-events-bridge"],function(c){c.jstree.defaults.finder={url:"",placeholder:"find ...",suggestion:{hint:"data.hint",info:"data.info",type:"data.type"}};var a=function(e){var d=document.createElement("input");d.type="text";d.className="xtree-finder";d.placeholder=e.finder.placeholder;new XWiki.widgets.Suggest(d,{align:"auto",className:"xtree-finder-suggestions",displayValue:true,displayValueText:"",fadeOnClear:false,hideButton:false,json:true,minchars:3,resultHint:e.finder.suggestion.hint,resultInfo:e.finder.suggestion.info,resultType:e.finder.suggestion.type,resultValue:"text",script:e.finder.url,timeout:0,varname:"query"});return d};var b=function(d,e){this.deselect_all();this.close_all();this.openTo(e.id,c.proxy(function(f){if(this.select_node(f)!==false){this.get_node(f,true).children(".jstree-anchor")[0].scrollIntoView(false)}},this))};c(document).on("xwiki:suggest:updated",function(d,e){if(c(e.container).hasClass("xtree-finder-suggestions")){c(e.container).find(".icon").each(function(){c(this).next(".value").prepend(this)})}});c.jstree.plugins.finder=function(d,e){this.init=function(g,f){e.init.call(this,g,f);c(a(f)).insertBefore(g).on("xwiki:suggest:selected",c.proxy(b,this))}}});