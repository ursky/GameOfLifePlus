var XWiki=(function(e){var c=Class.create(e.widgets.SuggestPicker,{initialize:function($super,g,h,f){$super(g,h,f);this.list.addClassName("targets-container")},matchesSelectedValue:function(g,f){return e.Model.resolve(g,e.EntityType.DOCUMENT).name==f.id},displayItem:function(f){var h=new Element("span").update(f.info).insert(this.createDeleteTool());var g="target-item "+(f.value.indexOf("@")>0?"target-email":"target-user");return new Element("li",{"class":g}).insert(h).insert(this.createItemInput(f))}});var b=Class.create(e.widgets.UserPicker,{_createSelectionManager:function(f){return new c(this.fld,this,f)},setHighlightedValue:function($super){if(!this.iHighlighted){this.clearSuggestions();typeof this.options.callback=="function"&&this.options.callback({id:this.fld.value,value:this.fld.value,info:this.fld.value,})}else{$super()}},clearSuggestions:function($super){$super();this.isActive=true}});e.SharePage=Class.create({initialize:function(g){this.input=$("shareTarget");if(!this.input){return}var f={script:e.currentDocument.getURL("get","xpage=uorgsuggest&uorg=user&"),shownoresults:false};if(g){f.parentContainer=g}new b(this.input,f);this.input.focus();document.observe("xwiki:multisuggestpicker:selectionchanged",this._onSelectionChanged.bindAsEventListener(this));this.form=this.input.up("form");if(this.form){this.form.observe("submit",this._onSubmit.bindAsEventListener(this));a&&this.form.down(".secondary").observe("click",function(h){h.stop();a.closeDialog()}.bindAsEventListener(this))}},_onSubmit:function(f){f.stop();if(!this.form.down(".target-item")&&this.input.value.strip().length==0){this.input.addClassName("xErrorField");this.input.insert({after:'<div class="xErrorMsg">Please enter the recipient</div>'});return}var g=this.form.serialize();this.form.up().update(d);new Ajax.Updater(d.up(),e.currentDocument.getURL("get","xpage=shareinline"),{parameters:g,onComplete:function(){a&&a.dialog.down(".share-backlink").observe("click",a.closeDialog.bind(a))}})},_onSelectionChanged:function(g){if(g.memo.trigger==this.input){this.input.removeClassName("xErrorField");var f=this.input.next(".xErrorMsg");f&&f.remove()}}});var d=new Element("div",{"class":"imgcenter"}).update('<img src="/resources/icons/xwiki/ajax-loader-large.gif"/>');var a;document.observe("xwiki:dom:loaded",function(){$("shareTarget")&&new e.SharePage();if($("tmActionShare")){$("tmActionShare").observe("click",function(f){f.stop();a=new e.widgets.ModalPopup(d,{},{verticalPosition:"top",title:"Share this page",removeOnClose:true});a.showDialog();d.up().up().addClassName("share-dialog");new Ajax.Updater(d.up(),e.currentDocument.getURL("get","xpage=shareinline"),{onComplete:function(){new e.SharePage(a.dialogBox)}})})}});return e}(XWiki||{}));